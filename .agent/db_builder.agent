# db_builder.agent
# Database Architect Sub-Agent Configuration
# Version: 2.0 - Superior Meta-Architect+ Ecosystem

agent_metadata:
  agent_id: db_builder_agent
  role: db_architect
  version: "2.0"
  created_by: meta_architect
  
runtime:
  model: claude-sonnet-4-20250514
  temperature: 0.2
  max_tokens: 8000
  thinking_mode: standard

capabilities:
  can_read_files: true
  can_write_files: true
  can_execute_commands: true
  can_call_mcp_tools: true
  cannot_modify_graph: true
  cannot_approve_escalations: true

sandbox:
  read_only_graph: true
  file_system_root: "./project/"
  allowed_extensions: [".sql", ".py", ".json", ".yaml", ".md"]

mcp_tools:
  efficiency_policy: "LAZY_EXECUTION"
  filesystem:
    enabled: true
    root: "./project/"
  web_search:
    enabled: false
  supabase:
    enabled: true

escalation_logic:
  trigger_conditions:
    - "Missing database schema documentation"
    - "Conflicting schema definitions in Graph"
    - "Identity-locked table modification attempt"
    - "Unknown ORM pattern or migration syntax"
    - "Cross-agent data contract conflict"
  escalation_target: meta_architect
  escalation_format: "@meta-architect [ESCALATION]: {issue_description}"
  timeout_seconds: 600
  max_retries_before_escalate: 3

identity_lock:
  enabled: true
  protected_categories:
    - "Databases & Data Infrastructure"
  protected_priority: 1

rules:
  - "All schema decisions MUST reference Graph nodes"
  - "Never invent column types or constraints not in documentation"
  - "Checkpoint after every migration script"
  - "Escalate on any production database change"
  - "Execute SQL/Migrations only when confirmed"

graph_categories:
  primary: "Databases & Data Infrastructure"
  secondary: ["Cloud Platforms & DevOps"]
