{
  "metadata": {
    "generated_at": "2026-02-27T23:50:00Z",
    "generated_by": "ENV_ENGINEER",
    "total_nodes": 45,
    "coverage": {
      "tier1": "17/17",
      "tier2": "20/M",
      "tier3": "100%"
    },
    "notes": "Added linting configuration nodes. implemented two-tier linting strategy for legacy debt management."
  },
  "nodes": [
    {
      "id": "apps/extension/src/background/service-worker.ts",
      "workspace": "extension",
      "type": "module",
      "responsibility": "Entry point for the Chrome Extension background service worker, initializes all core modules and starts the message router.",
      "dependencies": [
        "apps/extension/src/lib/config.ts",
        "apps/extension/src/background/modules/authManager.ts",
        "packages/shared/src/logic/promptSync.ts",
        "apps/extension/src/background/modules/dynamicMenus.ts",
        "apps/extension/src/background/modules/messageRouter.ts",
        "apps/extension/src/background/modules/networkObserver.ts",
        "apps/extension/src/background/modules/installationManager.ts",
        "apps/extension/src/background/modules/syncManager.ts"
      ],
      "dependents": [],
      "side_effects": ["chrome.storage.local", "chrome.runtime", "self.onerror"],
      "public_api": [],
      "status": "active"
    },
    {
      "id": "apps/extension/src/background/modules/authManager.ts",
      "workspace": "extension",
      "type": "module",
      "responsibility": "Manages authentication tokens for AI platforms and the BrainBox Dashboard, including encryption and session validation.",
      "dependencies": ["apps/extension/src/lib/crypto.ts", "apps/extension/src/lib/config.ts"],
      "dependents": [
        "apps/extension/src/background/service-worker.ts",
        "apps/extension/src/background/modules/messageRouter.ts"
      ],
      "side_effects": [
        "chrome.storage.local",
        "chrome.webRequest",
        "chrome.alarms",
        "fetch",
        "crypto.subtle"
      ],
      "public_api": [
        "initialize(): void",
        "setDashboardSession(session: any): Promise<void>",
        "getDashboardToken(): Promise<string | null>",
        "isSessionValid(): Promise<boolean>",
        "syncAll(): Promise<{ isValid: boolean, tokens: any }>"
      ],
      "status": "active"
    },
    {
      "id": "apps/extension/src/background/modules/syncManager.ts",
      "workspace": "extension",
      "type": "module",
      "responsibility": "Manages a persistent queue of items to be synchronized with the Dashboard, ensuring offline support and retry logic.",
      "dependencies": ["apps/extension/src/lib/crypto.ts", "apps/extension/src/lib/config.ts"],
      "dependents": [
        "apps/extension/src/background/service-worker.ts",
        "apps/extension/src/background/modules/dashboardApi.ts"
      ],
      "side_effects": ["chrome.storage.local", "fetch", "crypto.randomUUID"],
      "public_api": [
        "static getQueue(): Promise<SyncItem[]>",
        "static addToQueue(type: 'chat', data: any): Promise<void>",
        "static removeFromQueue(id: string): Promise<void>",
        "static processQueue(syncFn): Promise<void>",
        "static initialize(accessTokenParam): Promise<void>"
      ],
      "status": "active"
    },
    {
      "id": "apps/extension/src/background/modules/dashboardApi.ts",
      "workspace": "extension",
      "type": "module",
      "responsibility": "Handles core API operations for folders and chat saving, including intelligent tag generation logic.",
      "dependencies": [
        "apps/extension/src/lib/config.ts",
        "apps/extension/src/lib/rate-limiter.ts",
        "apps/extension/src/background/modules/cacheManager.ts",
        "apps/extension/src/background/modules/syncManager.ts"
      ],
      "dependents": ["apps/extension/src/background/modules/messageRouter.ts"],
      "side_effects": ["fetch"],
      "public_api": [
        "getOptimizedTags(messages: Message[]): string[]",
        "getUserFolders(): Promise<any>",
        "saveToDashboard(data: any, folderId?: string, silent?: boolean): Promise<any>"
      ],
      "status": "active"
    },
    {
      "id": "apps/extension/src/background/modules/networkObserver.ts",
      "workspace": "extension",
      "type": "module",
      "responsibility": "Monitors network requests to capture context-specific data like Claude organization IDs.",
      "dependencies": [],
      "dependents": ["apps/extension/src/background/service-worker.ts"],
      "side_effects": ["chrome.webRequest"],
      "public_api": ["initialize(): void"],
      "status": "active"
    },
    {
      "id": "apps/extension/src/background/modules/messageRouter.ts",
      "workspace": "extension",
      "type": "module",
      "responsibility": "Central hub for routing messages between content scripts, popup, and background modules with dependency injection.",
      "dependencies": [
        "apps/extension/src/background/modules/authManager.ts",
        "packages/shared/src/logic/promptSync.ts",
        "apps/extension/src/background/modules/platformAdapters/index.ts",
        "apps/extension/src/background/modules/dashboardApi.ts",
        "apps/extension/src/lib/config.ts"
      ],
      "dependents": ["apps/extension/src/background/service-worker.ts"],
      "side_effects": ["chrome.runtime.onMessage", "chrome.scripting.executeScript"],
      "public_api": ["listen(): void"],
      "status": "active"
    },
    {
      "id": "apps/dashboard/src/middleware.ts",
      "workspace": "dashboard",
      "type": "config",
      "responsibility": "Handles authentication, session persistence, and CORS headers for Extension API requests.",
      "dependencies": [],
      "dependents": [],
      "side_effects": ["process.env", "cookies"],
      "public_api": ["middleware(request: NextRequest): Promise<NextResponse>"],
      "status": "active"
    },
    {
      "id": "apps/dashboard/src/app/api/chats/route.ts",
      "workspace": "dashboard",
      "type": "api_route",
      "responsibility": "Standard REST API endpoints for chat CRUD operations with duplicate detection.",
      "dependencies": ["packages/validation/index.ts", "apps/dashboard/src/lib/supabase/server.ts"],
      "dependents": [],
      "side_effects": ["supabase", "cookies"],
      "public_api": [
        "GET(request: NextRequest)",
        "POST(request: NextRequest)",
        "PUT(request: NextRequest)",
        "DELETE(request: NextRequest)"
      ],
      "status": "active"
    },
    {
      "id": "apps/dashboard/src/app/api/chats/extension/route.ts",
      "workspace": "dashboard",
      "type": "api_route",
      "responsibility": "Specialized API endpoint for Extension to save chats with key verification and rate limiting.",
      "dependencies": [
        "packages/validation/index.ts",
        "apps/dashboard/src/lib/rate-limit.ts",
        "apps/dashboard/src/lib/supabase/server.ts"
      ],
      "dependents": [],
      "side_effects": ["supabase", "process.env"],
      "public_api": ["OPTIONS(request: NextRequest)", "POST(request: NextRequest)"],
      "status": "active"
    },
    {
      "id": "apps/dashboard/src/app/api/auth/callback/route.ts",
      "workspace": "dashboard",
      "type": "api_route",
      "responsibility": "Auth callback handler for Supabase authentication completion and redirection.",
      "dependencies": ["apps/dashboard/src/lib/supabase/server.ts"],
      "dependents": [],
      "side_effects": ["supabase", "cookies"],
      "public_api": ["GET(request: NextRequest)"],
      "status": "active"
    },
    {
      "id": "apps/dashboard/src/lib/supabase/client.ts",
      "workspace": "dashboard",
      "type": "module",
      "responsibility": "Supabase browser client factory with specialized cookie handling for 'Remember Me' functionality.",
      "dependencies": ["packages/database/database.types.ts", "apps/dashboard/src/lib/config.ts"],
      "dependents": [],
      "side_effects": ["localStorage", "document.cookie"],
      "public_api": ["createClient(): SupabaseClient"],
      "status": "active"
    },
    {
      "id": "apps/dashboard/src/lib/supabase/server.ts",
      "workspace": "dashboard",
      "type": "module",
      "responsibility": "Supabase server client factory for Next.js Server Components and API Routes.",
      "dependencies": ["packages/database/database.types.ts", "apps/dashboard/src/lib/config.ts"],
      "dependents": [
        "apps/dashboard/src/app/api/chats/route.ts",
        "apps/dashboard/src/app/api/chats/extension/route.ts",
        "apps/dashboard/src/app/api/auth/callback/route.ts"
      ],
      "side_effects": ["cookies"],
      "public_api": ["createServerSupabaseClient(): SupabaseClient"],
      "status": "active"
    },
    {
      "id": "packages/shared/src/types/index.ts",
      "workspace": "shared",
      "type": "module",
      "responsibility": "Centralized TypeScript type definitions and shared interfaces for the entire monorepo.",
      "dependencies": ["packages/database/database.types.ts"],
      "dependents": [
        "apps/extension/src/background/messageRouter.ts",
        "apps/dashboard/src/store/useChatStore.ts"
      ],
      "side_effects": [],
      "public_api": ["Chat", "Folder", "Prompt"],
      "status": "active"
    },
    {
      "id": "packages/validation/schemas/chat.ts",
      "workspace": "shared",
      "type": "module",
      "responsibility": "Zod schemas for chat data validation and platform enums.",
      "dependencies": ["packages/validation/schemas/message.ts"],
      "dependents": ["packages/validation/index.ts"],
      "side_effects": [],
      "public_api": ["platformEnum", "createChatSchema", "updateChatSchema"],
      "status": "active"
    },
    {
      "id": "packages/validation/schemas/folder.ts",
      "workspace": "shared",
      "type": "module",
      "responsibility": "Zod schemas for folder management validation.",
      "dependencies": [],
      "dependents": ["packages/validation/index.ts"],
      "side_effects": [],
      "public_api": ["folderTypeEnum", "createFolderSchema", "updateFolderSchema"],
      "status": "active"
    },
    {
      "id": "packages/validation/index.ts",
      "workspace": "shared",
      "type": "module",
      "responsibility": "Main entry point for @brainbox/validation package, consolidating all schemas.",
      "dependencies": [
        "packages/validation/schemas/chat.ts",
        "packages/validation/schemas/folder.ts"
      ],
      "dependents": [
        "apps/dashboard/src/app/api/chats/route.ts",
        "apps/dashboard/src/app/api/chats/extension/route.ts"
      ],
      "side_effects": [],
      "public_api": ["export * from ./schemas"],
      "status": "active"
    },
    {
      "id": "packages/database/database.types.ts",
      "workspace": "shared",
      "type": "module",
      "responsibility": "Auto-generated Supabase database types representing the schema.",
      "dependencies": [],
      "dependents": [
        "packages/shared/src/types/index.ts",
        "apps/dashboard/src/lib/supabase/client.ts",
        "apps/dashboard/src/lib/supabase/server.ts"
      ],
      "side_effects": [],
      "public_api": ["Database"],
      "status": "active"
    },
    {
      "id": "apps/extension/src/background/modules/platformAdapters/base.ts",
      "workspace": "extension",
      "type": "module",
      "responsibility": "Base class and interfaces for all platform-specific adapters (ChatGPT, Claude, etc.).",
      "dependencies": ["apps/extension/src/lib/logger.ts"],
      "dependents": [
        "apps/extension/src/background/modules/platformAdapters/chatgpt.adapter.ts",
        "apps/extension/src/background/modules/platformAdapters/claude.adapter.ts"
      ],
      "side_effects": [],
      "public_api": ["abstract class BasePlatformAdapter", "interface IPlatformAdapter"],
      "status": "active"
    },
    {
      "id": "packages/shared/src/services/ai.ts",
      "workspace": "shared",
      "type": "module",
      "responsibility": "Gateway service for all internal AI tasks (analysis, summary, enhancement) routing via central API.",
      "dependencies": ["packages/shared/src/config/ai_models_config.json"],
      "dependents": [],
      "side_effects": ["fetch"],
      "public_api": [
        "analyzeChatContent(content: string, ...): Promise<AIAnalysisResult>",
        "generatePromptImprovement(originalPrompt: string, ...): Promise<string>",
        "generateEmbedding(text: string, ...): Promise<number[]>"
      ],
      "status": "active"
    },
    {
      "id": "apps/extension/src/lib/crypto.ts",
      "workspace": "extension",
      "type": "module",
      "responsibility": "Handles encryption and decryption of sensitive platform tokens in local storage.",
      "dependencies": [],
      "dependents": ["apps/extension/src/background/modules/authManager.ts"],
      "side_effects": ["crypto.subtle", "PBKDF2"],
      "public_api": [
        "encryptToken(token: string): Promise<string>",
        "decryptToken(encryptedValue: any): Promise<string | null>"
      ],
      "status": "active"
    },
    {
      "id": "apps/extension/src/lib/normalizers.ts",
      "workspace": "extension",
      "type": "module",
      "responsibility": "Transforms platform-specific API responses (ChatGPT, Gemini, Claude, etc.) into a unified Common Schema.",
      "dependencies": ["apps/extension/src/lib/schemas.ts", "apps/extension/src/lib/logger.ts"],
      "dependents": [
        "apps/extension/src/background/modules/platformAdapters/chatgpt.adapter.ts",
        "apps/extension/src/background/modules/platformAdapters/gemini.adapter.ts"
      ],
      "side_effects": [],
      "public_api": [
        "normalizeChatGPT(rawData: any): Conversation",
        "normalizeClaude(rawData: any): Conversation",
        "normalizeGemini(parsedData: any, ...): Conversation"
      ],
      "status": "deprecated"
    },
    {
      "id": "apps/extension/src/lib/rate-limiter.ts",
      "workspace": "extension",
      "type": "module",
      "responsibility": "Implements Token Bucket algorithm to manage API request limits across various platforms.",
      "dependencies": [],
      "dependents": [
        "apps/extension/src/background/modules/dashboardApi.ts",
        "apps/extension/src/background/modules/platformAdapters/claude.adapter.ts"
      ],
      "side_effects": ["setTimeout"],
      "public_api": ["limiters: Record<string, RateLimiter>"],
      "status": "active"
    },
    {
      "id": "apps/extension/src/content/content-dashboard-auth.ts",
      "workspace": "extension",
      "type": "injection",
      "responsibility": "Bridges authentication from the Dashboard web app to the Extension via content script injection.",
      "dependencies": [],
      "dependents": [],
      "side_effects": [
        "localStorage",
        "chrome.runtime.sendMessage",
        "window.addEventListener('message')"
      ],
      "public_api": [],
      "status": "active"
    },
    {
      "id": "apps/extension/src/prompt-inject/prompt-inject.ts",
      "workspace": "extension",
      "type": "injection",
      "responsibility": "Injects the BrainBox prompt menu and context menu integration into AI platform pages (ChatGPT, Claude).",
      "dependencies": ["apps/extension/src/lib/logger.ts"],
      "dependents": [],
      "side_effects": ["DOM manipulation", "MutationObserver", "chrome.runtime.sendMessage"],
      "public_api": [],
      "status": "active"
    },
    {
      "id": "apps/dashboard/src/components/providers",
      "workspace": "dashboard",
      "type": "summary",
      "responsibility": "Global React Context providers (Data, Theme, Session) that wrap the entire dashboard application.",
      "dependencies": ["apps/dashboard/src/lib/supabase/client.ts"],
      "dependents": ["apps/dashboard/src/app/layout.tsx"],
      "side_effects": ["Zustand synchronization", "Supabase auth state changes"],
      "status": "active"
    },
    {
      "id": "apps/dashboard/src/components/layout",
      "workspace": "dashboard",
      "type": "summary",
      "responsibility": "Layout components (Sidebar, FolderTree, Shell) that define the dashboard's persistent navigation and structure.",
      "dependencies": ["apps/dashboard/src/store/useFolderStore.ts"],
      "dependents": ["apps/dashboard/src/app/layout.tsx"],
      "side_effects": [],
      "status": "active"
    },
    {
      "id": "apps/dashboard/src/components/features",
      "workspace": "dashboard",
      "type": "summary",
      "responsibility": "Feature-specific UI modules for Prompts, Chats, Folders, and AI Analysis functionality.",
      "dependencies": [
        "apps/dashboard/src/store/useChatStore.ts",
        "apps/dashboard/src/store/usePromptStore.ts",
        "packages/shared/src/utils/colors.ts"
      ],
      "dependents": [],
      "side_effects": [],
      "status": "active"
    },
    {
      "id": "packages/shared/src/utils",
      "workspace": "shared",
      "type": "summary",
      "responsibility": "Pure utility functions (Tailwind merging, folder tree logic, coloring) used across all packages.",
      "dependencies": [],
      "dependents": ["apps/dashboard/src/components/features", "apps/extension/src/popup"],
      "side_effects": [],
      "status": "active"
    },
    {
      "id": "apps/extension/src/popup",
      "workspace": "extension",
      "type": "summary",
      "responsibility": "Browser extension popup UI and controllers for quick access to chat saving and prompts.",
      "dependencies": [
        "apps/extension/src/background/modules/dashboardApi.ts",
        "packages/shared/src/utils"
      ],
      "dependents": [],
      "side_effects": ["chrome.runtime.sendMessage"],
      "status": "active"
    },
    {
      "id": "apps/extension/vite.config.ts",
      "workspace": "extension",
      "type": "config",
      "responsibility": "Vite build configuration with integrated stripDevCSP plugin for production manifest sanitization (removing localhost/127.0.0.1 and deprecated scripts).",
      "dependencies": [],
      "dependents": [],
      "side_effects": ["process.env.NODE_ENV", "fs.writeFileSync (dist/manifest.json)"],
      "public_api": ["stripDevCSP(): Plugin"],
      "status": "active"
    },
    {
      "id": "packages/shared/src/config/ai_models_config.json",
      "workspace": "shared",
      "type": "config",
      "responsibility": "Centralized configuration for AI models used across the project (Gemini Flash, Text-Embedding).",
      "dependencies": [],
      "dependents": [
        "packages/shared/src/services/ai.ts",
        "packages/shared/src/services/smart-prompt-search.ts"
      ],
      "side_effects": [],
      "public_api": [],
      "status": "active"
    },
    {
      "id": "eslint.config.mjs",
      "workspace": "root",
      "type": "config",
      "responsibility": "Monorepo ESLint configuration using Flat Config, implements two-tier validation (Strict vs Warn).",
      "status": "active"
    },
    {
      "id": ".lintstagedrc.js",
      "workspace": "root",
      "type": "config",
      "responsibility": "Configuration for lint-staged, manages pre-commit hooks with memory optimization and legacy debt handling.",
      "status": "active"
    }
  ]
}
