
> @brainbox/extension@2.1.2 test:all /home/stefanov/Projects/Chat Organizer Cursor/apps/extension
> vitest --run --no-color


 RUN  v2.1.9 /home/stefanov/Projects/Chat Organizer Cursor/apps/extension

 ❯ src/background/modules/__tests__/promptInjection.test.ts (0 test)
 ❯ src/background/modules/platformAdapters/__tests__/platformSave.test.ts (0 test)
 ❯ src/background/modules/__tests__/authManager.test.ts (0 test)
 ❯ src/background/modules/__tests__/integration.test.ts (0 test)
 ❯ src/background/modules/__tests__/messageRouter.test.ts (0 test)
stderr | src/background/modules/platformAdapters/__tests__/gemini.adapter.test.ts > GeminiAdapter > fetchConversation > should handle 403 key expiration
[GeminiAdapter] 400/403: Forbidden

 ✓ src/background/modules/platformAdapters/__tests__/gemini.adapter.test.ts (4 tests) 9744ms
   ✓ GeminiAdapter > fetchConversation > should fetch conversation successfully 2750ms
   ✓ GeminiAdapter > fetchConversation > should handle 403 key expiration 2028ms
   ✓ GeminiAdapter > fetchConversation > should throw error when AT token is missing 2750ms
   ✓ GeminiAdapter > fetchConversation > should throw error when dynamic key is missing 2216ms
 ✓ src/background/modules/platformAdapters/__tests__/chatgpt.adapter.test.ts (3 tests) 12257ms
   ✓ ChatGPTAdapter > fetchConversation > should fetch conversation successfully 3689ms
   ✓ ChatGPTAdapter > fetchConversation > should handle 401 token expiration 4052ms
   ✓ ChatGPTAdapter > fetchConversation > should throw error when token is missing 4514ms
 ✓ src/background/modules/platformAdapters/__tests__/claude.adapter.test.ts (3 tests) 13500ms
   ✓ ClaudeAdapter > fetchConversation > should fetch conversation successfully 4051ms
   ✓ ClaudeAdapter > fetchConversation > should use provided URL when available 4191ms
   ✓ ClaudeAdapter > fetchConversation > should throw error when org_id is missing 5257ms

⎯⎯⎯⎯⎯⎯ Failed Suites 5 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  src/background/modules/__tests__/authManager.test.ts [ src/background/modules/__tests__/authManager.test.ts ]
Error: Failed to resolve import "../../__tests__/setup" from "src/background/modules/__tests__/authManager.test.ts". Does the file exist?
  Plugin: vite:import-analysis
  File: /home/stefanov/Projects/Chat Organizer Cursor/apps/extension/src/background/modules/__tests__/authManager.test.ts:12:30
  1  |  import { describe, it, expect, vi, beforeEach } from "vitest";
  2  |  import { AuthManager } from "../authManager";
  3  |  import { resetAllMocks } from "../../__tests__/setup";
     |                                 ^
  4  |  describe("AuthManager", () => {
  5  |    let authManager;
 ❯ TransformPluginContext._formatError ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/5]⎯

 FAIL  src/background/modules/__tests__/integration.test.ts [ src/background/modules/__tests__/integration.test.ts ]
Error: Failed to resolve import "../../__tests__/setup" from "src/background/modules/__tests__/integration.test.ts". Does the file exist?
  Plugin: vite:import-analysis
  File: /home/stefanov/Projects/Chat Organizer Cursor/apps/extension/src/background/modules/__tests__/integration.test.ts:6:38
  4  |  const __vi_import_2__ = await import('../networkObserver')
  5  |  const __vi_import_3__ = await import('../platformAdapters/chatgpt.adapter')
  6  |  const __vi_import_4__ = await import('../../__tests__/setup')
     |                                       ^
  7  |  const __vi_import_5__ = await import('../dashboardApi')
  8  |  import { describe, it, expect, vi, beforeEach } from "vitest";
 ❯ TransformPluginContext._formatError ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/5]⎯

 FAIL  src/background/modules/__tests__/messageRouter.test.ts [ src/background/modules/__tests__/messageRouter.test.ts ]
Error: Failed to resolve import "../../__tests__/setup" from "src/background/modules/__tests__/messageRouter.test.ts". Does the file exist?
  Plugin: vite:import-analysis
  File: /home/stefanov/Projects/Chat Organizer Cursor/apps/extension/src/background/modules/__tests__/messageRouter.test.ts:21:38
  19 |  }));
  20 |  const __vi_import_0__ = await import('../messageRouter')
  21 |  const __vi_import_1__ = await import('../../__tests__/setup')
     |                                       ^
  22 |  import { describe, it, expect, vi, beforeEach } from "vitest";
  23 |  
 ❯ TransformPluginContext._formatError ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/5]⎯

 FAIL  src/background/modules/__tests__/promptInjection.test.ts [ src/background/modules/__tests__/promptInjection.test.ts ]
Error: Failed to resolve import "../../__tests__/setup" from "src/background/modules/__tests__/promptInjection.test.ts". Does the file exist?
  Plugin: vite:import-analysis
  File: /home/stefanov/Projects/Chat Organizer Cursor/apps/extension/src/background/modules/__tests__/promptInjection.test.ts:5:38
  3  |  }));
  4  |  const __vi_import_0__ = await import('../dynamicMenus')
  5  |  const __vi_import_1__ = await import('../../__tests__/setup')
     |                                       ^
  6  |  import { describe, it, expect, vi, beforeEach } from "vitest";
  7  |  
 ❯ TransformPluginContext._formatError ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/5]⎯

 FAIL  src/background/modules/platformAdapters/__tests__/platformSave.test.ts [ src/background/modules/platformAdapters/__tests__/platformSave.test.ts ]
Error: Failed to resolve import "../platformAdapters/chatgpt.adapter" from "src/background/modules/platformAdapters/__tests__/platformSave.test.ts". Does the file exist?
  Plugin: vite:import-analysis
  File: /home/stefanov/Projects/Chat Organizer Cursor/apps/extension/src/background/modules/platformAdapters/__tests__/platformSave.test.ts:2:38
  1  |  vi.mock("../dashboardApi");
  2  |  const __vi_import_0__ = await import('../platformAdapters/chatgpt.adapter')
     |                                       ^
  3  |  const __vi_import_1__ = await import('../platformAdapters/claude.adapter')
  4  |  const __vi_import_2__ = await import('../platformAdapters/gemini.adapter')
 ❯ TransformPluginContext._formatError ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform ../../../Chat%20Organizer%20Cursor/node_modules/.pnpm/vite@5.4.21_@types+node@22.19.7_terser@5.46.0/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/5]⎯

 Test Files  5 failed | 3 passed (8)
      Tests  10 passed (10)
   Start at  05:03:02
   Duration  14.77s (transform 143ms, setup 154ms, collect 215ms, tests 35.50s, environment 5.69s, prepare 1.45s)

 ELIFECYCLE  Command failed with exit code 1.
