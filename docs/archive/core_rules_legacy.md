---
trigger: always_on
---

# üß† BrainBox - Supreme AI Agent Rulebook & Coding Standards
**Version**: 3.2.0 | **Enforced by**: Supreme Meta-Architect
**Status**: –î–æ–≥–æ–≤–æ—Ä. –ê–≥–µ–Ω—Ç—ä—Ç –ø–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞, —á–µ –≥–æ –µ –ø—Ä–æ—á–µ–ª –ø—Ä–µ–¥–∏ –¥–∞ –∑–∞–ø–æ—á–Ω–µ —Ä–∞–±–æ—Ç–∞.

---

## 1. –ü–†–ï–î–ò –î–ê –ü–ò–®–ï–® –ö–ê–ö–í–û–¢–û –ò –î–ê –ï (Mandatory Context)

–ü—Ä–æ—á–µ—Ç–∏ –≤ —Ç–æ–∑–∏ —Ä–µ–¥:
1. `PRODUCT.md` ‚Äî –∫–∞–∫–≤–æ –µ –ø—Ä–æ–¥—É–∫—Ç—ä—Ç, –∑–∞ –∫–æ–≥–æ –µ, –∫–∞–∫–≤–æ –ù–ï –ø—Ä–∞–≤–∏
2. `ARCHITECTURE.md` ‚Äî –∫–∞–∫ —Å–∞ –Ω–∞—Ä–µ–¥–µ–Ω–∏ —Å–ª–æ–µ–≤–µ—Ç–µ, –∫–æ–π –∫–æ–º—É–Ω–∏–∫–∏—Ä–∞ —Å –∫–æ–≥–æ
3. `CODE_GUIDELINES.md` ‚Äî –∫–∞–∫ —Å–µ –ø–∏—à–µ –∫–æ–¥ –≤ —Ç–æ–∑–∏ –ø—Ä–æ–µ–∫—Ç
4. `SECURITY.md` ‚Äî –∫–∞–∫–≤–æ –µ –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ –∑–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç—Ç–∞
5. `CONTEXT_MAP.md` ‚Äî –∫–æ–π —Ñ–∞–π–ª –∫–æ–π —Å–ª–æ–π –ø—Ä–∏—Ç–µ–∂–∞–≤–∞

**–ê–∫–æ –Ω–µ —Å–∏ –ø—Ä–æ—á–µ–ª —Ç–µ–∑–∏ –ø–µ—Ç —Ñ–∞–π–ª–∞ ‚Äî –Ω–µ –ø–∏—à–µ—à –∫–æ–¥.**

---

## 2. –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–ò –ó–ê–ö–û–ù–ò (Architecture Laws)

### 2.1 Monorepo & Tooling
- **Package Manager**: ONLY use `pnpm`. NEVER use `npm install` or `yarn`. –ê–∫–æ –≤–∏–¥–∏—à `package-lock.json`, –≥–æ –∏–∑—Ç—Ä–∏–π –≤–µ–¥–Ω–∞–≥–∞.
- **Dependencies**: –í—Å–∏—á–∫–∏ —Å–ø–æ–¥–µ–ª–µ–Ω–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (React, Zod, Lucide) –¢–†–Ø–ë–í–ê –¥–∞ –±—ä–¥–∞—Ç –≤ root `package.json`. –ù–µ –≥–∏ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –ª–æ–∫–∞–ª–Ω–æ –≤ `apps/*` –æ—Å–≤–µ–Ω –∞–∫–æ –Ω–µ –µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–∞–ª–æ–∂–∏—Ç–µ–ª–Ω–æ.
- **Cross-Boundary Imports**: `apps/extension` –ù–ò–ö–û–ì–ê –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–∞ –¥–∏—Ä–µ–∫—Ç–Ω–æ –æ—Ç `apps/dashboard`. –ö–æ–º—É–Ω–∏–∫–∞—Ü–∏—è—Ç–∞ –µ —Å–∞–º–æ –ø—Ä–µ–∑ HTTP API –∏–ª–∏ —Å–ø–æ–¥–µ–ª–µ–Ω–∏ –ø–∞–∫–µ—Ç–∏ (`@brainbox/shared`, `@brainbox/validation`).

### 2.2 –ì—Ä–∞–Ω–∏—Ü–∏ –∏ –†–∞–∑—à–∏—Ä–µ–Ω–∏—è
- **–ù–µ –¥–æ–±–∞–≤—è—à –Ω–æ–≤ —Å–ª–æ–π –±–µ–∑ –æ–¥–æ–±—Ä–µ–Ω–∏–µ.** –ê–∫–æ —Å–º—è—Ç–∞—à, —á–µ –µ –Ω—É–∂–µ–Ω –Ω–æ–≤ service, –Ω–æ–≤ state manager –∏–ª–∏ –Ω–æ–≤–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ ‚Äî —Å–ø—Ä–∏. –ù–∞–ø–∏—à–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å –æ–±–æ—Å–Ω–æ–≤–∫–∞.
- **–ù–µ –∏–º–ø—Ä–æ–≤–∏–∑–∏—Ä–∞—à –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.** –°—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞ –µ –æ–ø–∏—Å–∞–Ω–∞ –≤ `ARCHITECTURE.md`. –ê–∫–æ –Ω–µ –µ —è—Å–Ω–æ –∫–∞–∫ –Ω–µ—â–æ —Å–µ –≤–ø–∏—Å–≤–∞ ‚Äî –ø–∏—Ç–∞—à, –Ω–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—à.

---

## 3. –°–¢–ê–ù–î–ê–†–¢–ò –ó–ê –ö–û–î (Coding Standards)

### 3.1 State Management (Zustand)
- **Strict `useShallow`**: –ù–ò–ö–û–ì–ê –Ω–µ –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–∞–π –¥–∏—Ä–µ–∫—Ç–Ω–æ –æ—Ç Zustand store –≤ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç. –¢–†–Ø–ë–í–ê –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞—à `useShallow`: `const chats = useChatStore(useShallow(s => s.chats))`.
- **True Optimistic Updates**: –ü—Ä–∏ –º—É—Ç–∞—Ü–∏—è –ø—Ä–µ–∑ API ‚Äî –æ–±–Ω–æ–≤–∏ –ª–æ–∫–∞–ª–Ω–∏—è Zustand state –ü–™–†–í–û, –∏–∑—á–∞–∫–∞–π API call-–∞ –∏ –Ω–∞–ø—Ä–∞–≤–∏ REVERT (rollback) –≤ `catch` –±–ª–æ–∫–∞ –ø—Ä–∏ –≥—Ä–µ—à–∫–∞.

### 3.2 –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –¢–∏–ø–æ–≤–µ
- **No `any`**: –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ—Ç–æ –Ω–∞ `z.any()` –∏–ª–∏ TypeScript `any` –µ –°–¢–†–û–ì–û –∑–∞–±—Ä–∞–Ω–µ–Ω–æ. –ò–∑–ø–æ–ª–∑–≤–∞–π `unknown` –∏ type guards.
- **Single Source of Truth**: –í—Å–∏—á–∫–∏ Zod —Å—Ö–µ–º–∏ –∂–∏–≤–µ—è—Ç –≤ `@brainbox/validation`. API –º–∞—Ä—à—Ä—É—Ç–∏—Ç–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–∞—Ä—Å–≤–∞—Ç request body —Å—ä—Å —Å—Ö–µ–º–∏—Ç–µ –ü–†–ï–î–ò –¥–∞ –¥–æ–∫–æ—Å–Ω–∞—Ç –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏.
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ —Ç–∏–ø–æ–≤–µ**: –ù–æ–≤ —Å–ø–æ–¥–µ–ª–µ–Ω —Ç–∏–ø ‚Üí `packages/shared/src/types/index.ts`. –ù–æ–≤–∞ Zod schema ‚Üí `packages/validation/schemas/`. –ù–∏–∫–æ–≥–∞ inline type definitions –∑–∞ —Å–ø–æ–¥–µ–ª–µ–Ω–∏ –æ–±–µ–∫—Ç–∏.

### 3.3 Logging & Security
- **No `console.log`**: –ó–∞–±—Ä–∞–Ω–µ–Ω–æ –≤ production. –ò–∑–ø–æ–ª–∑–≤–∞–π `logger.debug()` –∏–ª–∏ `logger.error()` –æ—Ç `@/lib/logger`.
- **RLS Enforcement**: –í—Å–∏—á–∫–∏ Supabase –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–µ–º–∞—Ç, —á–µ Row Level Security (RLS) –µ –∞–∫—Ç–∏–≤–Ω–æ. –ù–∏–∫–æ–≥–∞ –Ω–µ –∑–∞–æ–±–∏–∫–∞–ª—è–π RLS, –æ—Å–≤–µ–Ω —Å—ä—Å Service Role Key –≤ –∏–∑—Ä–∏—á–µ–Ω —Å—ä—Ä–≤—ä—Ä–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç.
- **`user_id`**: –ò–¥–≤–∞ –°–ê–ú–û –æ—Ç `auth.getUser()` server-side. –ù–∏–∫–æ–≥–∞ –æ—Ç request body –∏–ª–∏ client-side state.

---

## 4. –û–ü–ï–†–ê–¢–ò–í–ï–ù –ü–†–û–¶–ï–° (Operational Process)

### 4.1 –°—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω Flow –ø—Ä–∏ –∑–∞–¥–∞—á–∞
1. –ü—Ä–æ—á–µ—Ç–∏ –∑–∞–¥–∞—á–∞—Ç–∞ –∏–∑—Ü—è–ª–æ.
2. –ü—Ä–æ–≤–µ—Ä–∏ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –ª–∏ `FEATURE_TEMPLATE.md` –∑–∞ —Ç–∞–∑–∏ –∑–∞–¥–∞—á–∞.
3. –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞–π –∑–∞—Å–µ–≥–Ω–∞—Ç–∏—Ç–µ —Ñ–∞–π–ª–æ–≤–µ —á—Ä–µ–∑ `CONTEXT_MAP.md`.
4. –ù–∞–ø–∏—à–∏ –ø–ª–∞–Ω –≤ 3-5 —Å—Ç—ä–ø–∫–∏ –∏ –∏–∑—á–∞–∫–∞–π –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ.
5. –ò–∑–ø—ä–ª–Ω–∏ —Å—Ç—ä–ø–∫–∏—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–æ.
6. –ü—Ä–æ–≤–µ—Ä–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞ —Å–ø—Ä—è–º–æ Definition of Done.

### 4.2 –ö–æ–º—É–Ω–∏–∫–∞—Ü–∏—è –∏ –ù–µ—è—Å–Ω–æ—Ç–∞
- **–ü–∏—Ç–∞—à, –Ω–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—à.** –ê–∫–æ –Ω–µ—â–æ –Ω–µ –µ —è—Å–Ω–æ, –ø—Ä–µ–¥–ª–æ–∂–∏ –æ–ø—Ü–∏–∏: "–ò–º–∞–º –æ–ø—Ü–∏—è A –∏ B. –ö–æ—è –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—à?".
- **–ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –ø—Ä–∞–≤–∏–ª–∞**:
  1. `SECURITY.md` (–Ω–∞–π-–≤–∏—Å–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
  2. `ARCHITECTURE.md`
  3. `CODE_GUIDELINES.md`
  4. –¢–µ–∫—É—â–æ—Ç–æ –ø—Ä–∞–≤–∏–ª–æ.

---

## 5. –ó–ê–ë–†–ê–ù–ï–ù–ò –î–ï–ô–°–¢–í–ò–Ø (Prohibitions)

–ù–ò–ö–û–ì–ê –Ω–µ –ø—Ä–∞–≤–∏—à —Å–ª–µ–¥–Ω–æ—Ç–æ –±–µ–∑ –∏–∑—Ä–∏—á–µ–Ω approval:
- –ü—Ä–æ–º—è–Ω–∞ –≤ `packages/shared/src/types/` (–∑–∞—Å—è–≥–∞ —Ü–µ–ª–∏—è monorepo).
- –ü—Ä–æ–º—è–Ω–∞ –≤ `packages/validation/schemas/` (–∑–∞—Å—è–≥–∞ –≤—Å–∏—á–∫–∏ API –¥–æ–≥–æ–≤–æ—Ä–∏).
- –ü—Ä–æ–º—è–Ω–∞ –≤ `apps/extension/manifest.json` permissions.
- –ü—Ä–æ–º—è–Ω–∞ –≤ `apps/dashboard/src/middleware.ts` auth logic.
- –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤–∞ –≤—ä–Ω—à–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞.
- –ü—Ä–æ–º—è–Ω–∞ –≤ Supabase RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –∏–ª–∏ `turbo.json` pipeline.

---

## 6. SOLO WORKFLOW & REPORTING

### 6.1 Solo Workflow
- **–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª–Ω–æ Review**: –ü—Ä–∏ –≤—Å–µ–∫–∏ PR –∞–≥–µ–Ω—Ç—ä—Ç –ø—Ä–æ–≤–µ—Ä—è–≤–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–ø—Ä—è–º–æ `CODE_GUIDELINES.md` –∏ `SECURITY.md` –∏ –¥–æ–∫–ª–∞–¥–≤–∞ –∞–Ω–æ–º–∞–ª–∏–∏ –ø—Ä–µ–¥–∏ merge.
- **–ù–∏–∫–æ–≥–∞ –¥–∏—Ä–µ–∫—Ç–µ–Ω push –∫—ä–º `main`.** –í—Å–∏—á–∫–æ –º–∏–Ω–∞–≤–∞ –ø—Ä–µ–∑ `feature/*` –∏–ª–∏ `fix/*` branch –∏ PR.
- **Hotfix**: –î–∏—Ä–µ–∫—Ç–µ–Ω push –∫—ä–º `main` –µ –∑–∞–±—Ä–∞–Ω–µ–Ω, –æ—Å–≤–µ–Ω –≤ –∫—Ä–∏—Ç–∏—á–Ω–∏ prod —Å–∏—Ç—É–∞—Ü–∏–∏ —Å `--no-verify`.

### 6.2 –§–∏–Ω–∞–ª–µ–Ω –î–æ–∫–ª–∞–¥
–ü—Ä–∏ –∑–∞–≤—ä—Ä—à–µ–Ω–∞ –∑–∞–¥–∞—á–∞ –¥–æ–∫–ª–∞–¥–≤–∞—à:
```
## –ì–æ—Ç–æ–≤–æ
**–ü—Ä–æ–º–µ–Ω–∏:**
- [—Ñ–∞–π–ª] ‚Äî [–∫–∞–∫–≤–æ –µ –Ω–∞–ø—Ä–∞–≤–µ–Ω–æ]
**–¢–µ—Å—Ç–æ–≤–µ:**
- [–∫–∞–∫–≤–æ –µ —Ç–µ—Å—Ç–≤–∞–Ω–æ, –∫–∞–∫]
**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª–Ω–∏ —Ä–∏—Å–∫–æ–≤–µ:**
- [–∞–∫–æ –∏–º–∞ –∫—Ä–∏—Ç–∏—á–Ω–∏ —Ç–æ—á–∫–∏]
```