
> @brainbox/extension@2.1.2 test:all /home/stefanov/Projects/Chat Organizer Cursor/apps/extension
> vitest --run --no-color


 RUN  v2.1.9 /home/stefanov/Projects/Chat Organizer Cursor/apps/extension

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > listen() > should register message listener
[MessageRouter] ğŸ“¡ Listening for messages...

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > setAuthToken > should store tokens and trigger prompt sync
[MessageRouter] ğŸ“¨ setAuthToken { platform: undefined, hasData: false }

stdout | src/background/modules/__tests__/authManager.test.ts > AuthManager > initialize() > should register all network listeners
[AuthManager] ğŸ›¡ï¸ Initialized and listening.

stdout | src/background/modules/__tests__/authManager.test.ts > AuthManager > initialize() > should load tokens from storage on init
[AuthManager] ğŸ›¡ï¸ Initialized and listening.

stdout | src/background/modules/__tests__/authManager.test.ts > AuthManager > ChatGPT Token Capture > should capture Bearer token from Authorization header
[AuthManager] ğŸ›¡ï¸ Initialized and listening.

stdout | src/background/modules/__tests__/authManager.test.ts > AuthManager > ChatGPT Token Capture > should ignore non-Bearer tokens
[AuthManager] ğŸ›¡ï¸ Initialized and listening.

stdout | src/background/modules/__tests__/authManager.test.ts > AuthManager > Claude Org ID Capture > should extract org ID from API URL
[AuthManager] ğŸ›¡ï¸ Initialized and listening.

stdout | src/background/modules/__tests__/authManager.test.ts > AuthManager > Claude Org ID Capture > should handle invalid URLs gracefully
[AuthManager] ğŸ›¡ï¸ Initialized and listening.

stdout | src/background/modules/__tests__/authManager.test.ts > AuthManager > Gemini Dynamic Key Capture > should extract dynamic key from batchexecute request
[AuthManager] ğŸ›¡ï¸ Initialized and listening.

stdout | src/background/modules/__tests__/authManager.test.ts > AuthManager > Gemini Dynamic Key Capture > should handle various key formats (5-6 chars)
[AuthManager] ğŸ›¡ï¸ Initialized and listening.

stdout | src/background/modules/__tests__/authManager.test.ts > AuthManager > Gemini Dynamic Key Capture > should ignore non-batchexecute URLs
[AuthManager] ğŸ›¡ï¸ Initialized and listening.

stderr | src/background/modules/__tests__/authManager.test.ts > AuthManager > syncAll() > should handle network errors gracefully
[AuthManager] Sync ping failed: Error: Network error
    at /home/stefanov/Projects/Chat Organizer Cursor/apps/extension/src/background/modules/__tests__/authManager.test.ts:335:48
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
    at file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/vitest@2.1.9_@types+node@22.19.7_@vitest+ui@2.1.9_happy-dom@14.12.3_jsdom@27.4.0_terser@5.46.0/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:126:11

 âœ“ src/background/modules/__tests__/authManager.test.ts (19 tests) 57ms
stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > setAuthToken > should handle auth errors
[MessageRouter] ğŸ“¨ setAuthToken { platform: undefined, hasData: false }

stdout | src/background/modules/__tests__/integration.test.ts
[DashboardAPI] Using API_BASE_URL: http://localhost:3000

stdout | src/background/modules/__tests__/promptInjection.test.ts
[DashboardAPI] Using API_BASE_URL: http://localhost:3000

stdout | src/background/modules/__tests__/promptInjection.test.ts > Prompt Injection Tests > Context Menu Creation > should create all required menus
[DynamicMenus] ğŸ–±ï¸ Context menus initialized.
[DynamicMenus] âœ… All context menus created

stdout | src/background/modules/platformAdapters/__tests__/platformSave.test.ts
[DashboardAPI] Using API_BASE_URL: http://localhost:3000

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > checkDashboardSession > should return session validity
[MessageRouter] ğŸ“¨ checkDashboardSession { platform: undefined, hasData: false }

stdout | src/background/modules/__tests__/integration.test.ts > Integration Tests - End-to-End Flows > Flow 1: Login â†’ Capture Token â†’ Save Chat > should complete full ChatGPT save flow
[AuthManager] ğŸ›¡ï¸ Initialized and listening.

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > syncAll > should sync auth and prompts
[MessageRouter] ğŸ“¨ syncAll { platform: undefined, hasData: false }

stdout | src/background/modules/__tests__/promptInjection.test.ts > Prompt Injection Tests > Context Menu Creation > should create dynamic prompt submenus
[DynamicMenus] ğŸ–±ï¸ Context menus initialized.
[DynamicMenus] âœ… All context menus created
[DynamicMenus] âœ… All context menus created

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > fetchPrompts > should return all prompts
[MessageRouter] ğŸ“¨ fetchPrompts { platform: undefined, hasData: false }

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > syncPrompts > should trigger prompt sync
[MessageRouter] ğŸ“¨ syncPrompts { platform: undefined, hasData: false }

stderr | src/background/modules/__tests__/promptInjection.test.ts > Prompt Injection Tests > ChatGPT Prompt Injection > should require authentication for injection
[DynamicMenus] â›” User not logged in, redirecting...

stderr | src/background/modules/__tests__/promptInjection.test.ts > Prompt Injection Tests > Create Prompt from Selection > should require auth for creating prompts
[DynamicMenus] â›” User not logged in, redirecting...

stdout | src/background/modules/__tests__/promptInjection.test.ts > Prompt Injection Tests > Dynamic Menu Updates > should rebuild menus when prompts change
[DynamicMenus] ğŸ–±ï¸ Context menus initialized.
[DynamicMenus] âœ… All context menus created

stdout | src/background/modules/__tests__/promptInjection.test.ts > Prompt Injection Tests > Dynamic Menu Updates > should not rebuild on unrelated storage changes
[DynamicMenus] ğŸ–±ï¸ Context menus initialized.
[DynamicMenus] âœ… All context menus created

stderr | src/background/modules/__tests__/promptInjection.test.ts > Prompt Injection Tests > Error Handling > should handle sendMessage errors
[DynamicMenus] âŒ Injection failed: Error: Tab closed
    at /home/stefanov/Projects/Chat Organizer Cursor/apps/extension/src/background/modules/__tests__/promptInjection.test.ts:373:59
    at file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
    at file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/vitest@2.1.9_@types+node@22.19.7_@vitest+ui@2.1.9_happy-dom@14.12.3_jsdom@27.4.0_terser@5.46.0/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:126:11
    at withEnv (file:///home/stefanov/Projects/Chat%20Organizer%20Cursor/node_modules/.pnpm/vitest@2.1.9_@types+node@22.19.7_@vitest+ui@2.1.9_happy-dom@14.12.3_jsdom@27.4.0_terser@5.46.0/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:90:5)

 â¯ src/background/modules/__tests__/promptInjection.test.ts (13 tests | 2 failed) 222ms
   Ã— Prompt Injection Tests > Dynamic Menu Updates > should rebuild menus when prompts change 3ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Prompt Injection Tests > Dynamic Menu Updates > should not rebuild on unrelated storage changes 1ms
     â†’ Cannot read properties of undefined (reading '0')
stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > injectGeminiMainScript > should inject script into active tab
[MessageRouter] ğŸ“¨ injectGeminiMainScript { platform: undefined, hasData: false }

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > injectGeminiMainScript > should handle missing tab gracefully
[MessageRouter] ğŸ“¨ injectGeminiMainScript { platform: undefined, hasData: false }

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > storeGeminiToken > should store token in storage
[MessageRouter] ğŸ“¨ storeGeminiToken { platform: undefined, hasData: false }
[MessageRouter] âœ… Gemini AT token stored

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > storeGeminiToken > should handle missing token
[MessageRouter] ğŸ“¨ storeGeminiToken { platform: undefined, hasData: false }

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > getConversation > should fetch conversation from platform
[MessageRouter] ğŸ“¨ getConversation { platform: 'chatgpt', hasData: false }

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > saveToDashboard > should save conversation to dashboard
[MessageRouter] ğŸ“¨ saveToDashboard { platform: undefined, hasData: true }

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > getUserFolders > should fetch user folders
[MessageRouter] ğŸ“¨ getUserFolders { platform: undefined, hasData: false }

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > openLoginPage > should open login page in new tab
[MessageRouter] ğŸ“¨ openLoginPage { platform: undefined, hasData: false }

stdout | src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > Unknown action > should return false for unknown actions
[MessageRouter] ğŸ“¨ unknownAction { platform: undefined, hasData: false }

 â¯ src/background/modules/__tests__/messageRouter.test.ts (16 tests | 2 failed) 438ms
   Ã— MessageRouter > getConversation > should fetch conversation from platform 4ms
     â†’ Cannot read properties of undefined (reading 'then')
   Ã— MessageRouter > saveToDashboard > should save conversation to dashboard 1ms
     â†’ Cannot read properties of undefined (reading 'then')
stdout | src/background/modules/__tests__/integration.test.ts > Integration Tests - End-to-End Flows > Flow 2: Claude Org ID Discovery â†’ Save Chat > should capture org_id and save Claude chat
[NetworkObserver] ğŸ•µï¸ Listening for Claude org_id...

stdout | src/background/modules/__tests__/integration.test.ts > Integration Tests - End-to-End Flows > Flow 4: Sync All Platform Tokens > should capture and verify all platform tokens
[AuthManager] ğŸ›¡ï¸ Initialized and listening.
[NetworkObserver] ğŸ•µï¸ Listening for Claude org_id...

stderr | src/background/modules/platformAdapters/__tests__/gemini.adapter.test.ts > GeminiAdapter > fetchConversation > should handle 403 key expiration
[GeminiAdapter] 400/403: Forbidden

stderr | src/background/modules/platformAdapters/__tests__/platformSave.test.ts > Platform Save Flow Tests > Gemini Save Flow > should handle expired dynamic key
[GeminiAdapter] 400/403: Forbidden

 â¯ src/background/modules/platformAdapters/__tests__/platformSave.test.ts (9 tests | 5 failed) 9439ms
   Ã— Platform Save Flow Tests > ChatGPT Save Flow > should save ChatGPT conversation successfully 6ms
     â†’ saveToDashboard.mockResolvedValue is not a function
   âœ“ Platform Save Flow Tests > ChatGPT Save Flow > should handle ChatGPT token expiration 2170ms
   Ã— Platform Save Flow Tests > Claude Save Flow > should save Claude conversation successfully 1ms
     â†’ saveToDashboard.mockResolvedValue is not a function
   âœ“ Platform Save Flow Tests > Claude Save Flow > should handle missing org_id 2696ms
   Ã— Platform Save Flow Tests > Gemini Save Flow > should save Gemini conversation successfully 1ms
     â†’ saveToDashboard.mockResolvedValue is not a function
   âœ“ Platform Save Flow Tests > Gemini Save Flow > should handle expired dynamic key 2083ms
   âœ“ Platform Save Flow Tests > Gemini Save Flow > should handle missing AT token 2478ms
   Ã— Platform Save Flow Tests > Dashboard API Integration > should handle auth errors when saving 1ms
     â†’ saveToDashboard.mockRejectedValue is not a function
   Ã— Platform Save Flow Tests > Dashboard API Integration > should save to specific folder 1ms
     â†’ saveToDashboard.mockResolvedValue is not a function
 âœ“ src/background/modules/platformAdapters/__tests__/gemini.adapter.test.ts (4 tests) 10206ms
   âœ“ GeminiAdapter > fetchConversation > should fetch conversation successfully 2991ms
   âœ“ GeminiAdapter > fetchConversation > should handle 403 key expiration 2707ms
   âœ“ GeminiAdapter > fetchConversation > should throw error when AT token is missing 2236ms
   âœ“ GeminiAdapter > fetchConversation > should throw error when dynamic key is missing 2271ms
 âœ“ src/background/modules/platformAdapters/__tests__/chatgpt.adapter.test.ts (3 tests) 11123ms
   âœ“ ChatGPTAdapter > fetchConversation > should fetch conversation successfully 4091ms
   âœ“ ChatGPTAdapter > fetchConversation > should handle 401 token expiration 3645ms
   âœ“ ChatGPTAdapter > fetchConversation > should throw error when token is missing 3386ms
 â¯ src/background/modules/__tests__/integration.test.ts (6 tests | 4 failed) 11566ms
   Ã— Integration Tests - End-to-End Flows > Flow 1: Login â†’ Capture Token â†’ Save Chat > should complete full ChatGPT save flow 1060ms
     â†’ expected "spy" to be called with arguments: [ { success: true, â€¦(1) } ]

Received: 



Number of calls: 0

   Ã— Integration Tests - End-to-End Flows > Flow 2: Claude Org ID Discovery â†’ Save Chat > should capture org_id and save Claude chat 1002ms
     â†’ expected undefined to be 'org-claude-xyz789' // Object.is equality
   Ã— Integration Tests - End-to-End Flows > Flow 4: Sync All Platform Tokens > should capture and verify all platform tokens 1ms
     â†’ expected undefined to be defined
   âœ“ Integration Tests - End-to-End Flows > Flow 5: Network Error Recovery > should handle API failures gracefully 4348ms
   Ã— Integration Tests - End-to-End Flows > Flow 5: Network Error Recovery > should clear tokens on 401 5001ms
     â†’ Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 âœ“ src/background/modules/platformAdapters/__tests__/claude.adapter.test.ts (3 tests) 14573ms
   âœ“ ClaudeAdapter > fetchConversation > should fetch conversation successfully 6524ms
   âœ“ ClaudeAdapter > fetchConversation > should use provided URL when available 4847ms
   âœ“ ClaudeAdapter > fetchConversation > should throw error when org_id is missing 3201ms

â¯â¯â¯â¯â¯â¯ Failed Tests 13 â¯â¯â¯â¯â¯â¯â¯

 FAIL  src/background/modules/__tests__/integration.test.ts > Integration Tests - End-to-End Flows > Flow 1: Login â†’ Capture Token â†’ Save Chat > should complete full ChatGPT save flow
AssertionError: expected "spy" to be called with arguments: [ { success: true, â€¦(1) } ]

Received: 



Number of calls: 0

 â¯ src/background/modules/__tests__/integration.test.ts:120:30
    118| 
    119|       await vi.waitFor(() => {
    120|         expect(sendResponse).toHaveBeenCalledWith({
       |                              ^
    121|           success: true,
    122|           data: expect.objectContaining({

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/13]â¯

 FAIL  src/background/modules/__tests__/integration.test.ts > Integration Tests - End-to-End Flows > Flow 2: Claude Org ID Discovery â†’ Save Chat > should capture org_id and save Claude chat
AssertionError: expected undefined to be 'org-claude-xyz789' // Object.is equality

- Expected: 
"org-claude-xyz789"

+ Received: 
undefined

 â¯ src/background/modules/__tests__/integration.test.ts:185:39
    183|       await vi.waitFor(() => {
    184|         const storage = (chrome.storage.local as any)._getInternalStorâ€¦
    185|         expect(storage.claude_org_id).toBe('org-claude-xyz789');
       |                                       ^
    186|       });
    187| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/13]â¯

 FAIL  src/background/modules/__tests__/integration.test.ts > Integration Tests - End-to-End Flows > Flow 4: Sync All Platform Tokens > should capture and verify all platform tokens
AssertionError: expected undefined to be defined
 â¯ src/background/modules/__tests__/integration.test.ts:369:37
    367|       const storage = (chrome.storage.local as any)._getInternalStoragâ€¦
    368|       expect(storage.chatgpt_token).toBeDefined();
    369|       expect(storage.claude_org_id).toBeDefined();
       |                                     ^
    370|       expect(storage.gemini_dynamic_key).toBeDefined();
    371|       expect(storage.gemini_at_token).toBeDefined();

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/13]â¯

 FAIL  src/background/modules/__tests__/integration.test.ts > Integration Tests - End-to-End Flows > Flow 5: Network Error Recovery > should clear tokens on 401
Error: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/13]â¯

 FAIL  src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > getConversation > should fetch conversation from platform
TypeError: Cannot read properties of undefined (reading 'then')
 â¯ MessageRouter.handleGetConversation src/background/modules/messageRouter.ts:200:97
    198| 
    199|     private handleGetConversation(request: MessageRequest, sendResponsâ€¦
    200|         platformAdapters.fetchConversation(request.platform, request.câ€¦
       |                                                                                                 ^
    201|             .then(data => sendResponse({ success: true, data }))
    202|             .catch(error => sendResponse({ success: false, error: erroâ€¦
 â¯ MessageRouter.handleMessage src/background/modules/messageRouter.ts:90:29
 â¯ src/background/modules/__tests__/messageRouter.test.ts:277:30

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/13]â¯

 FAIL  src/background/modules/__tests__/messageRouter.test.ts > MessageRouter > saveToDashboard > should save conversation to dashboard
TypeError: Cannot read properties of undefined (reading 'then')
 â¯ MessageRouter.handleSaveConversation src/background/modules/messageRouter.ts:207:84
    205| 
    206|     private handleSaveConversation(request: MessageRequest, sendResponâ€¦
    207|         dashboardApi.saveToDashboard(request.data, request.folderId, râ€¦
       |                                                                                    ^
    208|             .then(result => sendResponse({ success: true, result }))
    209|             .catch(error => sendResponse({ success: false, error: erroâ€¦
 â¯ MessageRouter.handleMessage src/background/modules/messageRouter.ts:93:29
 â¯ src/background/modules/__tests__/messageRouter.test.ts:309:30

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/13]â¯

 FAIL  src/background/modules/__tests__/promptInjection.test.ts > Prompt Injection Tests > Dynamic Menu Updates > should rebuild menus when prompts change
TypeError: Cannot read properties of undefined (reading '0')
 â¯ src/background/modules/__tests__/promptInjection.test.ts:321:89
    319| 
    320|       // Trigger storage change listener
    321|       const storageListener = (chrome.storage.onChanged.addListener asâ€¦
       |                                                                                         ^
    322|       storageListener(mockChanges, 'local');
    323| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/13]â¯

 FAIL  src/background/modules/__tests__/promptInjection.test.ts > Prompt Injection Tests > Dynamic Menu Updates > should not rebuild on unrelated storage changes
TypeError: Cannot read properties of undefined (reading '0')
 â¯ src/background/modules/__tests__/promptInjection.test.ts:343:89
    341|       };
    342| 
    343|       const storageListener = (chrome.storage.onChanged.addListener asâ€¦
       |                                                                                         ^
    344|       storageListener(mockChanges, 'local');
    345| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/13]â¯

 FAIL  src/background/modules/platformAdapters/__tests__/platformSave.test.ts > Platform Save Flow Tests > ChatGPT Save Flow > should save ChatGPT conversation successfully
TypeError: saveToDashboard.mockResolvedValue is not a function
 â¯ src/background/modules/platformAdapters/__tests__/platformSave.test.ts:69:45
     67| 
     68|       // Mock Dashboard API
     69|       (dashboardApi.saveToDashboard as any).mockResolvedValue({
       |                                             ^
     70|         id: 'saved-chat-123',
     71|         success: true

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/13]â¯

 FAIL  src/background/modules/platformAdapters/__tests__/platformSave.test.ts > Platform Save Flow Tests > Claude Save Flow > should save Claude conversation successfully
TypeError: saveToDashboard.mockResolvedValue is not a function
 â¯ src/background/modules/platformAdapters/__tests__/platformSave.test.ts:168:45
    166|       });
    167| 
    168|       (dashboardApi.saveToDashboard as any).mockResolvedValue({
       |                                             ^
    169|         id: 'saved-claude-123',
    170|         success: true

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/13]â¯

 FAIL  src/background/modules/platformAdapters/__tests__/platformSave.test.ts > Platform Save Flow Tests > Gemini Save Flow > should save Gemini conversation successfully
TypeError: saveToDashboard.mockResolvedValue is not a function
 â¯ src/background/modules/platformAdapters/__tests__/platformSave.test.ts:266:45
    264|       });
    265| 
    266|       (dashboardApi.saveToDashboard as any).mockResolvedValue({
       |                                             ^
    267|         id: 'saved-gemini-123',
    268|         success: true

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/13]â¯

 FAIL  src/background/modules/platformAdapters/__tests__/platformSave.test.ts > Platform Save Flow Tests > Dashboard API Integration > should handle auth errors when saving
TypeError: saveToDashboard.mockRejectedValue is not a function
 â¯ src/background/modules/platformAdapters/__tests__/platformSave.test.ts:343:45
    341|       });
    342| 
    343|       (dashboardApi.saveToDashboard as any).mockRejectedValue(
       |                                             ^
    344|         new Error('Session expired')
    345|       );

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/13]â¯

 FAIL  src/background/modules/platformAdapters/__tests__/platformSave.test.ts > Platform Save Flow Tests > Dashboard API Integration > should save to specific folder
TypeError: saveToDashboard.mockResolvedValue is not a function
 â¯ src/background/modules/platformAdapters/__tests__/platformSave.test.ts:364:45
    362|       });
    363| 
    364|       (dashboardApi.saveToDashboard as any).mockResolvedValue({
       |                                             ^
    365|         id: 'saved-123',
    366|         folder_id: 'folder-work'

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/13]â¯

 Test Files  4 failed | 4 passed (8)
      Tests  13 failed | 60 passed (73)
   Start at  05:08:30
   Duration  15.81s (transform 392ms, setup 165ms, collect 578ms, tests 57.62s, environment 5.28s, prepare 646ms)

â€‰ELIFECYCLEâ€‰ Command failed with exit code 1.
