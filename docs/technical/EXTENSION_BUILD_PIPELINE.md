# üèóÔ∏è EXTENSION_BUILD_PIPELINE.md - –ü—Ä–æ—Ü–µ—Å –Ω–∞ –∏–∑–≥—Ä–∞–∂–¥–∞–Ω–µ

**–í–µ—Ä—Å–∏—è**: 3.1.0  
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**: Vite 7, CRXJS, TypeScript 5.9  
**–ü–æ—Å–ª–µ–¥–Ω–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è**: 2026-02-10

–¢–æ–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å–≤–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª –Ω–∞ –±–∏–ª–¥–∞ –Ω–∞ Chrome Extension-–∞ –∏ –º–µ—Ö–∞–Ω–∏–∑–º–∏—Ç–µ –∑–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –∫–æ–º–ø–∏–ª–∞—Ü–∏—è.

---

## üõ†Ô∏è Build Pipeline (Vite + CRXJS)

–ü—Ä–æ—Ü–µ—Å—ä—Ç –Ω–∞ –∏–∑–≥—Ä–∞–∂–¥–∞–Ω–µ –µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω —á—Ä–µ–∑ `apps/extension/vite.config.ts` –∏ —Å–ª–µ–¥–≤–∞ —Ç–µ–∑–∏ —Å—Ç—ä–ø–∫–∏:

1.  **Environment Loading**: Vite –∑–∞—Ä–µ–∂–¥–∞ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏—Ç–µ –æ—Ç `.env` —Ñ–∞–π–ª–æ–≤–µ—Ç–µ (–Ω–∞–ø—Ä. `VITE_DASHBOARD_URL`).
2.  **Manifest Transformation (Pre-build)**: 
    - –°–∫—Ä–∏–ø—Ç—ä—Ç —á–µ—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—è `manifest.json`.
    - –ó–∞–º–µ–Ω—è –ø–ª–µ–π—Å—Ö–æ–ª–¥—ä—Ä–∞ `__DASHBOARD_URL__` —Å —Ä–µ–∞–ª–Ω–∏—è URL –Ω–∞ —Ç–∞–±–ª–æ—Ç–æ.
    - CRXJS –∞–Ω–∞–ª–∏–∑–∏—Ä–∞ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –∑–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –≤—Ö–æ–¥–Ω–∏ —Ç–æ—á–∫–∏ (Background, Content Scripts, Popup).
3.  **Compilation & Bundling**:
    - **TypeScript**: –ö–æ–¥—ä—Ç —Å–µ –∫–æ–º–ø–∏–ª–∏—Ä–∞ –æ—Ç `src/` –∫—ä–º ESM –º–æ–¥—É–ª–∏.
    - **Optimization**: –ü—Ä–∏ –ø—Ä–æ–¥—É–∫—Ü–∏—è —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ `esbuild.drop: ['console', 'debugger']`.
4.  **Security Hardening (Post-build plugin: `stripDevCSP`)**:
    –°–ª–µ–¥ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ –Ω–∞ –±–∏–ª–¥–∞, –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω –ø–ª—ä–≥–∏–Ω –∏–∑–≤—ä—Ä—à–≤–∞ —Å–ª–µ–¥–Ω–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è –≤—ä—Ä—Ö—É `dist/`:
    - **Manifest Scrubbing**: –ü—Ä–µ–º–∞—Ö–≤–∞ `localhost`, `127.0.0.1` –∏ `ws://` –æ—Ç CSP, `host_permissions` –∏ `content_scripts`.
    - **Recursive Asset Scrubbing**: –°–∫–∞–Ω–∏—Ä–∞ –≤—Å–∏—á–∫–∏ `.js`, `.json` –∏ `.html` —Ñ–∞–π–ª–æ–≤–µ.
    - **False Positive Removal**: –ó–∞–º–µ–Ω—è `__REACT_DEVTOOLS_GLOBAL_HOOK__` —Å –Ω–µ—É—Ç—Ä–∞–ª–µ–Ω —Å—Ç—Ä–∏–Ω–≥ –∑–∞ –∏–∑–±—è–≥–≤–∞–Ω–µ –Ω–∞ –¥–µ—Ç–µ–∫—Ü–∏—è –æ—Ç —Å–∫–µ–Ω–µ—Ä–∏ –∑–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç.
    - **Placeholder Replacement**: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞, —á–µ –Ω—è–º–∞ –æ—Å—Ç–∞–Ω–∞–ª–∏ `localhost:3000` —Å—Ç—Ä–∏–Ω–≥–æ–≤–µ –≤ –∫–æ–º–ø–∏–ª–∏—Ä–∞–Ω–∏—è –∫–æ–¥.

---

## üìÇ –¢–µ—Å—Ç–≤–∞–Ω–µ –∏ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

–ë–∏–ª–¥—ä—Ç –≤–∫–ª—é—á–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω–∏ —Ç–µ—Å—Ç–æ–≤–µ —á—Ä–µ–∑ **Vitest**:

| –ö–æ–º–∞–Ω–¥–∞ | –û–±—Ö–≤–∞—Ç |
| :--- | :--- |
| `pnpm test:auth` | –¢–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ `AuthManager` –∏ —Ç–æ–∫–µ–Ω –±—Ä–∏–¥–∂–∞. |
| `pnpm test:router` | –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è—Ç–∞ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏—è. |
| `pnpm test:platforms` | –¢–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –∞–¥–∞–ø—Ç–µ—Ä–∏ –∑–∞ AI –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏. |
| `pnpm test:coverage` | –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –æ—Ç—á–µ—Ç –∑–∞ –ø–æ–∫—Ä–∏—Ç–∏–µ –Ω–∞ –∫–æ–¥–∞. |

---

## üöÄ –ö–æ–º–∞–Ω–¥–∏ –∑–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

| –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ | –†–µ–∑—É–ª—Ç–∞—Ç |
| :--- | :--- | :--- |
| `pnpm dev` | –°—Ç–∞—Ä—Ç–∏—Ä–∞ Vite HMR —Å—ä—Ä–≤—ä—Ä | Hot Module Replacement –≤ –±—Ä–∞—É–∑—ä—Ä–∞. |
| `pnpm build` | Production –±–∏–ª–¥ | –û–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω –∏ ‚Äû–≤—Ç–≤—ä—Ä–¥–µ–Ω‚Äú `dist/` –ø–∞–∫–µ—Ç. |
| `pnpm type-check` | TypeScript –≤–∞–ª–∏–¥–∞—Ü–∏—è | –ù—É–ª–µ–≤–∞ —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç –∫—ä–º —Ç–∏–ø–æ–≤–∏ –≥—Ä–µ—à–∫–∏. |

---

> [!CAUTION]
> **–ù–∏–∫–æ–≥–∞** –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–π—Ç–µ `dist/manifest.json`. –ü—Ä–æ—Ü–µ—Å—ä—Ç `stripDevCSP` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞ —Ñ–∏–Ω–∞–ª–Ω–∞—Ç–∞ –≤–µ—Ä—Å–∏—è. –í—Å—è–∫–∞ —Ä—ä—á–Ω–∞ –Ω–∞–º–µ—Å–∞ —â–µ –±—ä–¥–µ –ø—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–∞ –ø—Ä–∏ —Å–ª–µ–¥–≤–∞—â–∏—è –±–∏–ª–¥.

---
*–î–æ–∫—É–º–µ–Ω—Ç—ä—Ç –µ —á–∞—Å—Ç –æ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—Ç–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ BrainBox v3.1.*
